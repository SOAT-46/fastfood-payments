services:
    mongodb:
        image: 'mongo:latest'
        container_name: mongodb
        environment:
            MONGO_INITDB_DATABASE: 'fastfood'
            MONGO_INITDB_ROOT_USERNAME: 'root'
            MONGO_INITDB_ROOT_PASSWORD: 'password'
        ports:
            - "27017:27017"
        volumes:
            - mongodb_data:/data/db
        networks:
            - app-network
        healthcheck:
            test: ["CMD", "mongosh", "--eval", "db.runCommand({ ping: 1 })"]
            interval: 10s
            retries: 5

    app:
        image: 'app:latest'
        build:
            context: ../
        environment:
            SPRING_DATA_MONGODB_URI: mongodb://root:password@mongodb:27017/fastfood?authSource=admin
        ports:
            - "8081:8080"
        depends_on:
            mongodb:
                condition: service_healthy
        networks:
            - app-network

volumes:
    mongodb_data:

networks:
    app-network:
